<!--
Copyright 2015 Google Inc. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<kd-help-section>
  <md-input-container class="md-block" md-is-error="ctrl.isNameError()">
    <label>App name</label>
    <input ng-model="ctrl.name" name="name" namespace="ctrl.namespace" required kd-unique-name ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 500, 'blur': 0 } }">
    <md-progress-linear class="kd-deploy-form-name-progress" md-mode="indeterminate"
        ng-show="ctrl.form.name.$pending">
    </md-progress-linear>
    <ng-messages for="ctrl.form.name.$error" role="alert" multiple>
      <ng-message when="required">Application name is required.</ng-message>
      <ng-message when="uniqueName">
        Application with this name already exists within namespace <i>{{ctrl.namespace}}</i>.
      </ng-message>
    </ng-messages>
  </md-input-container>
  <kd-user-help>
    An 'app' label with this value will be added to the Replica Set and Service that get deployed.
  </kd-user-help>
</kd-help-section>

<kd-help-section>
  <md-input-container class="md-block">
    <label>Container image</label>
    <input ng-model="ctrl.containerImage" name="containerImage" required>
    <ng-messages for="ctrl.form.containerImage.$error" role="alert" multiple>
      <ng-message when="required">Container image is required.</ng-message>
    </ng-messages>
  </md-input-container>
  <kd-user-help>
    Enter the URL of a public image on any registry, or a private image hosted on Docker Hub or Google Container Registry.
    <a href="">Learn more</a>
  </kd-user-help>
</kd-help-section>

<kd-help-section>
  <md-input-container class="md-block">
    <label>Number of pods</label>
    <input ng-model="ctrl.replicas" type="number" required min="1">
  </md-input-container>
  <kd-user-help>
    A Replica Set will be created to maintain the desired number of pods across your cluster.
    <a href="">Learn more</a>
  </kd-user-help>
</kd-help-section>

<kd-help-section>
  <div layout="row" ng-repeat="portMapping in ctrl.portMappings">
    <md-input-container flex>
      <label>Port</label>
      <input ng-model="portMapping.port" type="number" min="0">
    </md-input-container>
    <md-input-container flex>
      <label>Target port</label>
      <input ng-model="portMapping.targetPort" type="number" min="0">
    </md-input-container>
    <md-input-container flex="none">
      <label>Protocol</label>
      <md-select ng-model="portMapping.protocol" required>
        <md-option ng-repeat="protocol in ctrl.protocols" ng-value="protocol">
          {{protocol}}
        </md-option>
      </md-select>
    </md-input-container>
  </div>
  <kd-user-help>
    Ports are optional. If specified, a Service will be created mapping the Port (incoming) to a target Port seen by the container.
    <span ng-if="ctrl.name">The internal DNS name for this Service will be: <b>{{ctrl.name}}</b>.</span>
    <a href="">Learn more</a>
  </kd-user-help>
</kd-help-section>

<kd-help-section>
  <md-switch ng-model="ctrl.isExternal" class="md-primary">
    Expose service externally
  </md-switch>
</kd-help-section>

<div ng-show="ctrl.isMoreOptionsEnabled()">
  <kd-help-section>
    <md-input-container>
      <label>Description (optional)</label>
      <textarea ng-model="ctrl.description"></textarea>
    </md-input-container>
    <kd-user-help>
      The description will be added as an annotation to the Replica Set and displayed in the application's details.
    </kd-user-help>
  </kd-help-section>

  <kd-help-section>
    <div>
      <div>Labels (optional)</div>
      <div layout="column">
        <div layout="row">
          <p flex>Key</p>
          <p flex>Value</p>
        </div>
        <div ng-repeat="label in ctrl.labels">
          <kd-deploy-label layout="row" flex label="label" labels="ctrl.labels"></kd-deploy-label>
        </div>
      </div>
    </div>
    <kd-user-help>
      The specified labels will be applied to the created Replica Set, Service (if any) and Pods. Common labels include release, environment, tier, partition and track.
      <a href="">Learn more</a>
    </kd-user-help>
  </kd-help-section>

  <kd-help-section>
    <md-input-container class="md-block">
      <label>Namespace</label>
      <md-select ng-model="ctrl.namespace" required>
        <md-option ng-repeat="namespace in ctrl.namespaces" ng-value="namespace">
          {{namespace}}
        </md-option>
        <md-option ng-click="ctrl.handleNamespaceDialog($event)">
          Create a new namespace...
        </md-option>
      </md-select>
    </md-input-container>
    <kd-user-help>
      Namespaces let you partition resources into logically named groups.
      <a href="">Learn more</a>
    </kd-user-help>
  </kd-help-section>

  <kd-help-section>
    <div>
      <md-input-container class="md-block">
        <label>Run command (optional)</label>
        <input ng-model="ctrl.containerCommand">
      </md-input-container>

      <md-input-container class="md-block">
        <label>Run command arguments (optional)</label>
        <input ng-model="ctrl.containerCommandArgs">
      </md-input-container>
    </div>
    <kd-user-help>
      By default, your containers run the selected image's default entrypoint command. You can
      use the command options to override the default.
      <a href="">Learn more</a>
    </kd-user-help>
  </kd-help-section>
  
  <kd-help-section>
    <md-switch ng-model="ctrl.runAsPrivileged" class="md-primary">
      Run as privileged
    </md-switch>
    <kd-user-help>
      Processes in privileged containers are equivalent to be running as root on the host.
    </kd-user-help>
  </kd-help-section>
</div>

<md-button class="md-primary kd-deploy-moreoptions-button" type="button"
           ng-click="ctrl.switchMoreOptions()"
           ng-hide="ctrl.isMoreOptionsEnabled()">
  <md-icon>arrow_drop_down</md-icon>More options
</md-button>

<md-button class="md-primary kd-deploy-moreoptions-button" type="button"
           ng-click="ctrl.switchMoreOptions()"
           ng-show="ctrl.isMoreOptionsEnabled()">
  <md-icon>arrow_drop_up</md-icon>Less options
</md-button>
